// ============================================================
// CARD DATA - Personal compliments for Caitlyn
// ============================================================

import { Card, TextCard, VoucherCard, PlaylistCard } from "../types";
import { OPEN_WHEN_CATEGORIES, OpenWhenKey } from "../config";
import { getRedeemedVoucherCardIds } from "../utils/storage";

// ===== PET NAME SYSTEM =====
// Weighted pet name selection for variety
const PET_POOL = ["babe", "baby", "Caitlyn"] as const;
const PET_WEIGHTS = [0.6, 0.25, 0.15];

export function pickPet(): string {
  const r = Math.random();
  let acc = 0;
  for (let i = 0; i < PET_POOL.length; i++) {
    acc += PET_WEIGHTS[i];
    if (r <= acc) return PET_POOL[i];
  }
  return "Caitlyn";
}

export function withPet(text: string): string {
  return text.replace(/{pet}/g, pickPet());
}

// ===== TEXT COMPLIMENTS =====
const textCards: TextCard[] = [
  // ---------------- SWEET / ROMANTIC ----------------
  {
    id: "sweet-001",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’•",
    tags: ["lonely"],
    text: "{pet}, the way you text me goodnight makes the distance feel smaller.",
  },
  {
    id: "sweet-002",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ¥¹",
    tags: ["lonely"],
    text: "I like that we can be quiet together without it being weird.",
  },
  {
    id: "sweet-003",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "âœ¨",
    tags: ["lonely"],
    text: "The way you scrunch your nose when you laugh. That's mine now.",
  },
  {
    id: "sweet-004",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’ª",
    tags: ["lonely"],
    text: "You chose me back. That still hits different.",
  },
  {
    id: "sweet-005",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸªž",
    tags: ["lonely"],
    text: "You make me want to be the guy who remembers the little things.",
  },
  {
    id: "sweet-006",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ˜Š",
    tags: ["lonely"],
    text: "When you get excited talking about PT stuff, your whole face changes. I could watch that for hours.",
  },
  {
    id: "sweet-007",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŒŸ",
    tags: ["lonely"],
    text: "Grocery runs with you feel like dates. That's how I know.",
  },
  {
    id: "sweet-008",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ”„",
    tags: ["lonely"],
    text: "You're the person I want to tell first when something happens.",
  },
  {
    id: "sweet-009",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ ",
    tags: ["lonely"],
    text: "Falling asleep next to you is the most peaceful I ever feel.",
  },
  {
    id: "sweet-010",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ‘‘",
    tags: ["lonely"],
    text: "I still get a little nervous before I see you. In the good way.",
  },
  {
    id: "sweet-011",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŽµ",
    tags: ["lonely"],
    text: "The way you hum while you're doing stuff. I don't think you notice, but I do.",
  },
  {
    id: "sweet-012",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ™",
    tags: ["lonely"],
    text: "You remembered that thing I mentioned once, weeks ago. That's love.",
  },
  {
    id: "sweet-013",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ§¸",
    tags: ["lonely"],
    text: "You let me see the soft parts of you. I don't take that lightly.",
  },
  {
    id: "sweet-014",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "âœ¨",
    tags: ["lonely"],
    text: "The little forehead kiss you give me when you think I'm asleep. I'm not always asleep.",
  },
  {
    id: "sweet-015",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’—",
    tags: ["lonely"],
    text: "I like that we have our own language now. The looks, the inside jokes.",
  },
  {
    id: "sweet-016",
    type: "text",
    category: "sweet",
    rarity: "rare",
    intensity: 2,
    emoji: "ðŸ“…",
    tags: ["lonely"],
    text: "April 13, 2024. I didn't know that was the day everything would start making more sense.",
  },
  {
    id: "anniversary-counter",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "",
    tags: ["lonely", "special"],
    text: "ANNIVERSARY_COUNTER",
  },
  {
    id: "sweet-018",
    type: "text",
    category: "sweet",
    rarity: "rare",
    intensity: 2,
    emoji: "ðŸ¡",
    tags: ["lonely"],
    text: "I think about what our morning routine will look like someday. Coffee, you half-asleep, me trying not to be annoying.",
  },
  {
    id: "sweet-019",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’",
    tags: ["lonely"],
    text: "You don't have to perform for me. The real you is who I signed up for.",
  },
  {
    id: "sweet-020",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ›¡ï¸",
    tags: ["lonely"],
    text: "When you fall asleep on my chest, I hold my breath so I don't wake you.",
  },

  // ---------------- SPECIFIC MEMORIES ----------------
  {
    id: "mem-001",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ’",
    tags: ["lonely"],
    text: "Ball Arena. First date. You wore that outfit and I forgot how to act normal.",
  },
  {
    id: "mem-002",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ˜",
    tags: ["lonely"],
    text: "I kept glancing at you more than the game. The Avs won but honestly I wasn't paying attention.",
  },
  {
    id: "mem-003",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ“£",
    tags: ["lonely"],
    text: "When you got loud cheering at the game I thought, 'okay yeah, this one's different.'",
  },
  {
    id: "mem-004",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ•ï¸",
    tags: ["lonely"],
    text: "That stick teepee we found on May 6th. We sat inside it like idiots and I wanted to stay forever.",
  },
  {
    id: "mem-005",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ§—",
    tags: ["lonely"],
    text: "You on that rock ledge, totally unbothered. I was trying not to look panicked while being very into it.",
  },
  {
    id: "mem-006",
    type: "text",
    category: "sweet",
    rarity: "rare",
    intensity: 2,
    emoji: "ðŸ¥¾",
    tags: ["lonely"],
    text: "I like how you get competitive on hikes. You speed up and think I don't notice.",
  },
  {
    id: "mem-007",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ¤—",
    tags: ["lonely"],
    text: "That full-speed run you do when you come greet me. Arms out, biggest smile. Wrecks me every time.",
  },
  {
    id: "mem-008",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "â„ï¸",
    tags: ["lonely"],
    text: "It's 20 degrees and you come outside in socks to kiss me anyway. Caitlyn.",
  },
  {
    id: "mem-009",
    type: "text",
    category: "sweet",
    rarity: "rare",
    intensity: 2,
    emoji: "ðŸ˜´",
    tags: ["lonely"],
    text: "You fall asleep sitting up with your legs crossed like a little meditation goblin. Obsessed.",
  },
  {
    id: "mem-010",
    type: "text",
    category: "sweet",
    rarity: "rare",
    intensity: 2,
    emoji: "ðŸ’",
    tags: ["lonely"],
    text: "Driveway hockey with you. You cheating. Me pretending I didn't see. Perfect.",
  },

  // ---------------- SUPPORTIVE (PhD / clinic / life goals) ----------------
  {
    id: "sup-001",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŽ“",
    tags: ["stressed"],
    text: "Shoulders down. Jaw unclenched. You're doing a PhD, not defusing a bomb.",
  },
  {
    id: "sup-002",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŒ¬ï¸",
    tags: ["stressed"],
    text: "Close the laptop. Drink water. The work will still be there in 10 minutes.",
  },
  {
    id: "sup-003",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ—ï¸",
    tags: ["doubting"],
    text: "You're not behind. You're just in the middle of the hard part.",
  },
  {
    id: "sup-004",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ‘",
    tags: ["stressed"],
    text: "You showed up today. That counts. Full stop.",
  },
  {
    id: "sup-005",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ§ ",
    tags: ["doubting"],
    text: "You casually drop muscle origins and insertions in conversation. That's not normal smart. That's you.",
  },
  {
    id: "sup-006",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ¦´",
    tags: ["stressed"],
    text: "I have no idea what the brachial plexus is but I know you're going to crush that exam.",
  },
  {
    id: "sup-007",
    type: "text",
    category: "supportive",
    rarity: "rare",
    intensity: 2,
    emoji: "ðŸ¥",
    tags: ["doubting"],
    text: "Your name on a clinic door. That's not if, it's when.",
  },
  {
    id: "sup-008",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ©º",
    tags: ["stressed"],
    text: "Someone is going to be in pain someday and you're going to help them heal. You're training for that right now.",
  },
  {
    id: "sup-009",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’ª",
    tags: ["doubting"],
    text: "You've done hard things before. This is another one. Same you.",
  },
  {
    id: "sup-010",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ’§",
    tags: ["stressed"],
    text: "Water. Snack. Five deep breaths. Then back at it if you want.",
  },
  {
    id: "sup-011",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸƒ",
    tags: ["stressed"],
    text: "{pet}, a PhD is years of showing up when you don't feel like it. You're still here.",
  },
  {
    id: "sup-012",
    type: "text",
    category: "supportive",
    rarity: "rare",
    intensity: 2,
    emoji: "ðŸ¦´",
    tags: ["doubting"],
    text: "You rattled off nerve pathways the other day like it was nothing. Caitlyn. That's not normal.",
  },
  {
    id: "sup-013",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ“‹",
    tags: ["doubting"],
    text: "{pet}, you're not wishing for a clinic. You're studying for one. That's different.",
  },
  {
    id: "sup-014",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŽ­",
    tags: ["doubting"],
    text: "Impostor syndrome means you're doing something hard enough to scare yourself. Keep going.",
  },
  {
    id: "sup-015",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ›¡ï¸",
    tags: ["stressed"],
    text: "{pet}, the way you explain things to peopleâ€”patient and clearâ€”that's already who you are.",
  },
  {
    id: "sup-016",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "âœ¨",
    tags: ["doubting"],
    text: "You don't have to feel confident to be capable. You're both right now.",
  },
  {
    id: "sup-017",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ—ï¸",
    tags: ["stressed"],
    text: "Feeling behind doesn't mean you are. Look how far you've come.",
  },
  {
    id: "sup-018",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ˜´",
    tags: ["stressed"],
    text: "{pet}, taking a break isn't quitting. It's part of the work.",
  },
  {
    id: "sup-019",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŒ…",
    tags: ["doubting"],
    text: "Hard days don't cancel progress. You're still moving forward.",
  },
  {
    id: "sup-020",
    type: "text",
    category: "supportive",
    rarity: "rare",
    intensity: 2,
    emoji: "ðŸ¥",
    tags: ["doubting"],
    text: "I can already picture you walking patients through their recovery plan. It's going to happen.",
  },

  // ---------------- BODY IMAGE ----------------
  {
    id: "bi-001",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’—",
    tags: ["doubting"],
    text: "When your brain gets loud about your body, I'm here to be louder about how much I love it.",
  },
  {
    id: "bi-002",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸƒ",
    tags: ["doubting"],
    text: "Your body hikes mountains, plays hockey, snowboards, and handles grad school. That's powerful.",
  },
  {
    id: "bi-003",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŒ¸",
    tags: ["doubting"],
    text: "On the days your brain is unkind, I'll double down on being gentle with you.",
  },
  {
    id: "bi-004",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ‘€",
    tags: ["doubting"],
    text: "I see the whole picture. You're stuck looking at pixels. Trust my view.",
  },
  {
    id: "bi-005",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ¤",
    tags: ["doubting"],
    text: "Talk to yourself like I talk to you. That's the assignment.",
  },

  // ---------------- OVERTHINKING / OVERSTIMULATION ----------------
  {
    id: "calm-001",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ”‡",
    tags: ["overstimulated"],
    text: "Noise off. Lights low. I'll match your quiet until you're ready.",
  },
  {
    id: "calm-002",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ¤",
    tags: ["overstimulated"],
    text: "You don't have to find the right words. I'll wait.",
  },
  {
    id: "calm-003",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ§˜",
    tags: ["overstimulated"],
    text: "Racing thoughts? Okay. We can just sit here until they slow down.",
  },
  {
    id: "calm-004",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŒ€",
    tags: ["stressed"],
    text: "Overthinking is your brain in protection mode. Let's turn it off for a bit.",
  },
  {
    id: "calm-005",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "âš”ï¸",
    tags: ["doubting"],
    text: "Whatever's weighing on youâ€”you don't have to solve it alone. We can figure it out.",
  },

  // ---------------- FUNNY / PLAYFUL ----------------
  {
    id: "fun-001",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ”¥",
    tags: ["laugh"],
    text: "Pretty, smart, and a little unhinged. The whole package.",
  },
  {
    id: "fun-002",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ”¬",
    tags: ["laugh"],
    text: "Women in STEM > everyone. Especially when it's you.",
  },
  {
    id: "fun-003",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ¦´",
    tags: ["laugh"],
    text: "You: naming every muscle in the leg. Me: 'that's the knee bone, right?'",
  },
  {
    id: "fun-004",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ§©",
    tags: ["laugh"],
    text: "Between your overthinking and my underthinking, we're one very mediocre brain.",
  },
  {
    id: "fun-005",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ›",
    tags: ["laugh"],
    text: "Loving you? Feature, not a bug.",
  },
  {
    id: "fun-006",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ“±",
    tags: ["laugh"],
    text: "Your text notification is the only one I don't ignore.",
  },
  {
    id: "fun-007",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸŸ",
    tags: ["laugh"],
    text: "I'd let you steal fries off my plate. That's peak trust.",
  },
  {
    id: "fun-008",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ˜¤",
    tags: ["laugh"],
    text: "Your dramatic reactions are part of your charm. I said what I said.",
  },
  {
    id: "fun-009",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ˜ˆ",
    tags: ["laugh"],
    text: "I only poke fun because your reactions are elite. But I stop when you mean it.",
  },
  {
    id: "fun-010",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ’",
    tags: ["laugh"],
    text: "Your hockey form is questionable but your trash talk is elite.",
  },
  {
    id: "fun-011",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ‘¯",
    tags: ["laugh"],
    text: "We're both weirdos. That's why it works.",
  },
  {
    id: "fun-012",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ“„",
    tags: ["laugh"],
    text: "If you were a research paper, I'd actually read past the abstract.",
  },

  // ---------------- FLIRTY-LITE ----------------
  {
    id: "flirt-001",
    type: "text",
    category: "spicy-lite",
    rarity: "common",
    intensity: 2,
    emoji: "âš ï¸",
    tags: ["lonely"],
    text: "That look you give me when you're being flirty. Yeah, I noticed.",
  },
  {
    id: "flirt-002",
    type: "text",
    category: "spicy-lite",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ¤—",
    tags: ["lonely"],
    text: "Need you closer. Specifically right now.",
  },
  {
    id: "flirt-003",
    type: "text",
    category: "spicy-lite",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŽ®",
    tags: ["lonely"],
    text: "When you bite your lip like that I lose track of what I was saying.",
  },
  {
    id: "flirt-004",
    type: "text",
    category: "spicy-lite",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸš¨",
    tags: ["lonely"],
    text: "You in that hoodie of mine is doing something to me.",
  },
  {
    id: "flirt-005",
    type: "text",
    category: "spicy-lite",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’¯",
    tags: ["lonely"],
    text: "All of you. That's what I'm into. Every part.",
  },

  // ---------------- OUTDOORS / ADVENTURE ----------------
  {
    id: "out-001",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ¥¾",
    tags: ["lonely"],
    text: "Watching you power up a switchback like it's personal. I love that energy.",
  },
  {
    id: "out-002",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ§—",
    tags: ["lonely"],
    text: "You on the climbing wall, focused, slightly sweaty. Yeah. Good view.",
  },
  {
    id: "out-003",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ•ï¸",
    tags: ["lonely"],
    text: "Campfire, your head on my shoulder, no cell service. Perfect.",
  },
  {
    id: "out-004",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ”ï¸",
    tags: ["lonely"],
    text: "Every trailhead feels like ours now. Colorado with you hits different.",
  },
  {
    id: "out-005",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŒ²",
    tags: ["stressed"],
    text: "When things feel heavy, let's go outside. Trees help.",
  },
  {
    id: "out-006",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ—ºï¸",
    tags: ["lonely"],
    text: "I've got a mental list of places I want to take you. It keeps growing.",
  },

  // ---------------- FLOWERS / LITTLE LOVE ----------------
  {
    id: "flw-001",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’",
    tags: ["lonely"],
    text: "You light up when you get flowers. I'm taking notes.",
  },
  {
    id: "flw-002",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸŒ·",
    tags: ["lonely"],
    text: "The way you take a picture of every bouquet. Pure Caitlyn behavior.",
  },
  {
    id: "flw-003",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸŒ»",
    tags: ["laugh"],
    text: "Just say the word and I'm at Trader Joe's grabbing flowers. I know my role.",
  },

  // ---------------- FUTURE / MARRIAGE / MOVING OUT ----------------
  {
    id: "fut-001",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ¡",
    tags: ["lonely"],
    text: "Our own place. Coffee in the morning. Falling asleep together every night. That's the plan.",
  },
  {
    id: "fut-002",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "â™¾ï¸",
    tags: ["lonely"],
    text: "I think about growing old with you. Genuinely. Not poetically.",
  },
  {
    id: "fut-003",
    type: "text",
    category: "supportive",
    rarity: "rare",
    intensity: 2,
    emoji: "âœ…",
    tags: ["doubting"],
    text: "Your PT clinic. Our home. Us building something. I'm locked in.",
  },
  {
    id: "fut-004",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ’‘",
    tags: ["lonely"],
    text: "Not near each other. Together. Same house, same life. That's what I want.",
  },

  // ---------------- SECRET (earned, personal) ----------------
  {
    id: "secret-001",
    type: "text",
    category: "secret",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸŽ¬",
    tags: ["lonely"],
    text: "Avs game. You in that outfit. I was nervous the whole time and I didn't want it to end.",
  },
  {
    id: "secret-002",
    type: "text",
    category: "secret",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ”ï¸",
    tags: ["lonely"],
    text: "That cliff on May 6th. You weren't scared at all. That's when I knew you were different.",
  },
  {
    id: "secret-003",
    type: "text",
    category: "secret",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ¤—",
    tags: ["lonely"],
    text: "You coming outside in the cold just to hug me before I leave. That's my whole heart.",
  },
  {
    id: "secret-004",
    type: "text",
    category: "secret",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ˜´",
    tags: ["lonely"],
    text: "Watching you sleep, curled up weird, legs crossedâ€”I want to protect that forever.",
  },
  {
    id: "secret-005",
    type: "text",
    category: "secret",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ’",
    tags: ["lonely"],
    text: "I think about marrying you. Not vaguelyâ€”specifically. You. A real ring. A real life.",
  },
  {
    id: "secret-006",
    type: "text",
    category: "secret",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ’–",
    tags: ["lonely"],
    text: "Caitlyn Hoffman. You're the one. That's it. That's the card.",
  },

  // ---------------- OPEN WHENâ€¦ (curated) ----------------
  {
    id: "ow-001",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ˜®â€ðŸ’¨",
    tags: ["stressed"],
    text: "Open when stressed: Close your eyes. Three slow breaths. The to-do list can wait 60 seconds.",
  },
  {
    id: "ow-002",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ†",
    tags: ["stressed"],
    text: "Open when stressed: You woke up. You tried. That's already enough for today.",
  },
  {
    id: "ow-003",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ“ˆ",
    tags: ["doubting"],
    text: "Open when doubting: Remember the last hard thing you got through? Same brain. Same you.",
  },
  {
    id: "ow-004",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ§ ",
    tags: ["doubting"],
    text: "Open when doubting: You're not faking it. You studied for this. You know your stuff.",
  },
  {
    id: "ow-005",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ˜œ",
    tags: ["laugh"],
    text: "Open when you need a laugh: Imagine me doing a silly little dance right now. You're welcome.",
  },
  {
    id: "ow-006",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ¦·",
    tags: ["laugh"],
    text: "Open when you need a laugh: I let you bite me once. Once. I'm still recovering emotionally.",
  },
  {
    id: "ow-007",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ¤«",
    tags: ["overstimulated"],
    text: "Open when overstimulated: No words needed. I'm here. Just breathe.",
  },
  {
    id: "ow-008",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ¤",
    tags: ["overstimulated"],
    text: "Open when overstimulated: Soft blanket. Low lights. I'll handle the noise.",
  },
  {
    id: "ow-009",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’­",
    tags: ["lonely"],
    text: "Open when lonely: I just thought about you. Probably smiling. Definitely missing you.",
  },
  {
    id: "ow-010",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’—",
    tags: ["lonely"],
    text: "Open when lonely: You're not alone in this. I'm with you, even from here.",
  },

  // ---------------- EXTRA PET NAME CARDS ----------------
  {
    id: "pet-001",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸŽ¬",
    tags: ["lonely"],
    text: "{pet}, that first Avs game dateâ€”I replay it in my head more than you know.",
  },
  {
    id: "pet-002",
    type: "text",
    category: "sweet",
    rarity: "rare",
    intensity: 3,
    emoji: "ðŸ˜",
    tags: ["lonely"],
    text: "You walked into that arena looking unreal, {pet}. I couldn't focus on the game.",
  },
  {
    id: "pet-003",
    type: "text",
    category: "sweet",
    rarity: "rare",
    intensity: 3,
    emoji: "ðŸ“£",
    tags: ["lonely"],
    text: "When you screamed at that goal, {pet}â€”yeah. I was already falling.",
  },
  {
    id: "pet-004",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ•ï¸",
    tags: ["lonely"],
    text: "{pet}, that teepee we found on May 6th. I keep thinking about how you looked right then.",
  },
  {
    id: "pet-005",
    type: "text",
    category: "sweet",
    rarity: "rare",
    intensity: 2,
    emoji: "ðŸ¤—",
    tags: ["lonely"],
    text: "The full-speed run you do when I get there, {pet}. Arms open. It fixes everything.",
  },
  {
    id: "pet-006",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŽ“",
    tags: ["stressed"],
    text: "{pet}, you're in a doctoral program. That's not casual. Be easy on yourself.",
  },
  {
    id: "pet-007",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ§ ",
    tags: ["stressed"],
    text: "I don't get half the words you're studying, {pet}, but I see how hard you work.",
  },
  {
    id: "pet-008",
    type: "text",
    category: "supportive",
    rarity: "rare",
    intensity: 2,
    emoji: "ðŸ¥",
    tags: ["doubting"],
    text: "{pet}, that clinic is going to exist. People are going to heal because of you.",
  },
  {
    id: "pet-009",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŒ¬ï¸",
    tags: ["stressed"],
    text: "You're allowed to stop and do nothing for a minute, {pet}. Rest is part of it.",
  },
  {
    id: "pet-010",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’—",
    tags: ["doubting"],
    text: "{pet}, when your brain's being harsh, text me. I'll remind you what's real.",
  },
  {
    id: "pet-011",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ”‡",
    tags: ["overstimulated"],
    text: "{pet}, if it's too much right now, I'll go quiet. Just say the word.",
  },
  {
    id: "pet-012",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "âš”ï¸",
    tags: ["doubting"],
    text: "Whatever it is, I'm on your side first, {pet}. Always.",
  },
  {
    id: "pet-013",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŒŠ",
    tags: ["stressed"],
    text: "Big feelings are fine, {pet}. I can sit with all of it.",
  },
  {
    id: "pet-014",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ¥¾",
    tags: ["lonely"],
    text: "You're always down for a trail, {pet}. That's one of my favorite things about you.",
  },
  {
    id: "pet-015",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ—ºï¸",
    tags: ["lonely"],
    text: "Every adventure is better because it's with you, {pet}.",
  },
  {
    id: "pet-016",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’",
    tags: ["lonely"],
    text: "{pet}, I love how your face lights up when I bring you flowers.",
  },
  {
    id: "pet-017",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ’ª",
    tags: ["lonely"],
    text: "I want to be the one you can count on, {pet}. Steady. There.",
  },
  {
    id: "pet-018",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "ðŸ¡",
    tags: ["lonely"],
    text: "{pet}, I think about us having our own place. Mornings together. Dogs eventually. All of it.",
  },
  {
    id: "pet-019",
    type: "text",
    category: "sweet",
    rarity: "legendary",
    intensity: 3,
    emoji: "â™¾ï¸",
    tags: ["lonely"],
    text: "Long-term with you, {pet}. That's what I'm building toward.",
  },
  {
    id: "pet-020",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸ§˜",
    tags: ["lonely"],
    text: "I want to be peace in your life, {pet}. Not more noise.",
  },
  {
    id: "pet-021",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ˜ˆ",
    tags: ["laugh"],
    text: "{pet}, I poke fun because your reactions are tier-one content. But I know when to stop.",
  },
  {
    id: "pet-022",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ”¥",
    tags: ["laugh"],
    text: "Hot and smart, {pet}. Some people have it all. You're those people.",
  },
  {
    id: "pet-023",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ‘¯",
    tags: ["laugh"],
    text: "We're both weird in compatible ways, {pet}. That's the magic.",
  },
  {
    id: "pet-024",
    type: "text",
    category: "spicy-lite",
    rarity: "common",
    intensity: 2,
    emoji: "âš ï¸",
    tags: ["lonely"],
    text: "{pet}, that look you give me sometimes. Devastating. In the best way.",
  },
  {
    id: "pet-025",
    type: "text",
    category: "spicy-lite",
    rarity: "common",
    intensity: 2,
    emoji: "ðŸŽ®",
    tags: ["lonely"],
    text: "When you smile at me like that, {pet}, I forget what I was gonna say.",
  },

  // ---------------- SHORT "INFINITE FEEL" MINIS ----------------
  {
    id: "mini-001",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ’—",
    tags: ["lonely"],
    text: "Still my favorite.",
  },
  {
    id: "mini-002",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "â¤ï¸",
    tags: ["lonely"],
    text: "Love you.",
  },
  {
    id: "mini-003",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ†",
    tags: ["stressed"],
    text: "Proud of you. Always.",
  },
  {
    id: "mini-004",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ‘£",
    tags: ["stressed"],
    text: "One thing at a time.",
  },
  {
    id: "mini-005",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ’ª",
    tags: ["doubting"],
    text: "You got this.",
  },
  {
    id: "mini-006",
    type: "text",
    category: "funny",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ…",
    tags: ["laugh"],
    text: "Certified cute. That's you.",
  },
  {
    id: "mini-007",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ¥º",
    tags: ["lonely"],
    text: "Thinking about you.",
  },
  {
    id: "mini-008",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ¥‡",
    tags: ["lonely"],
    text: "Top tier human. You.",
  },
  {
    id: "mini-009",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ¤«",
    tags: ["overstimulated"],
    text: "Quiet together.",
  },
  {
    id: "mini-010",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ€",
    tags: ["lonely"],
    text: "Lucky it's you.",
  },
  {
    id: "mini-012",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ’­",
    tags: ["lonely"],
    text: "Miss you, {pet}.",
  },
  {
    id: "mini-013",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ†",
    tags: ["stressed"],
    text: "So proud, {pet}.",
  },
  {
    id: "mini-014",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ›¡ï¸",
    tags: ["stressed"],
    text: "Safe here.",
  },
  {
    id: "mini-015",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ’",
    tags: ["lonely"],
    text: "You're loved.",
  },
  {
    id: "mini-016",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸŒ¬ï¸",
    tags: ["overstimulated"],
    text: "Breathe. I'm here.",
  },
  {
    id: "mini-017",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 1,
    emoji: "âš”ï¸",
    tags: ["doubting"],
    text: "Your team, {pet}.",
  },
  {
    id: "mini-018",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "â­",
    tags: ["lonely"],
    text: "Love you, {pet}.",
  },
  {
    id: "mini-019",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 1,
    emoji: "âœ¨",
    tags: ["stressed"],
    text: "Doing great.",
  },
  {
    id: "mini-020",
    type: "text",
    category: "supportive",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸ’¯",
    tags: ["doubting"],
    text: "Enough. Just as you are.",
  },
  {
    id: "mini-021",
    type: "text",
    category: "sweet",
    rarity: "common",
    intensity: 1,
    emoji: "ðŸŒŸ",
    tags: ["lonely"],
    text: "Amazing, {pet}.",
  },
];

// ===== VOUCHER CARDS =====
const voucherCards: VoucherCard[] = [
  {
    id: "voucher-001",
    type: "voucher",
    category: "sweet",
    rarity: "rare",
    tags: ["lonely"],
    emoji: "ðŸ’",
    title: "Redeem for flowers ðŸ’",
    options: [
      "Surprise bouquet + note",
      "Pick the flowers together",
      "Flowers + coffee date",
    ],
  },
  {
    id: "voucher-002",
    type: "voucher",
    category: "supportive",
    rarity: "legendary",
    tags: ["stressed"],
    emoji: "ðŸ«¶",
    title: "Redeem for comfort mode ðŸ«¶",
    options: [
      "Quiet cuddle + show",
      "Snack run + blanket burrito",
      "Massage + early night",
    ],
  },
  {
    id: "voucher-003",
    type: "voucher",
    category: "sweet",
    rarity: "rare",
    tags: ["lonely"],
    emoji: "ðŸ”ï¸",
    title: "Redeem for an adventure day ðŸ”ï¸",
    options: [
      "Hike + photos",
      "Climbing + food after",
      "Snow day + hot drinks",
    ],
  },
  {
    id: "voucher-004",
    type: "voucher",
    category: "sweet",
    rarity: "rare",
    tags: ["lonely"],
    emoji: "ðŸŽ¬",
    title: "Redeem for movie night ðŸŽ¬",
    options: ["You pick the movie", "Cozy blankets + snacks", "Movie marathon"],
  },
  {
    id: "voucher-005",
    type: "voucher",
    category: "sweet",
    rarity: "rare",
    tags: ["lonely"],
    emoji: "ðŸ•",
    title: "Redeem for dinner date ðŸ•",
    options: [
      "Your restaurant pick",
      "Cook together at home",
      "Takeout + candlelight",
    ],
  },
];

// ===== PLAYLIST CARDS =====
const playlistCards: PlaylistCard[] = [
  {
    id: "playlist-001",
    type: "playlist",
    category: "sweet",
    rarity: "rare",
    tags: ["lonely"],
    emoji: "ðŸŽµ",
    songTitle: "Die With A Smile",
    artist: "Lady Gaga, Bruno Mars",
    link: "https://open.spotify.com/track/2plbrEY59IikOBgBGLjaoe",
  },
  {
    id: "playlist-002",
    type: "playlist",
    category: "sweet",
    rarity: "rare",
    tags: ["lonely"],
    emoji: "ðŸ’•",
    songTitle: "Electric Love",
    artist: "BORNS",
    link: "https://open.spotify.com/track/2GiJYvgVaD2HtM8GqD9EgQ",
  },
  {
    id: "playlist-003",
    type: "playlist",
    category: "sweet",
    rarity: "rare",
    tags: ["lonely"],
    emoji: "ðŸŽ¶",
    songTitle: "Lover",
    artist: "Taylor Swift",
    link: "https://open.spotify.com/track/1dGr1c8CrMLDpV6mPbImSI",
  },
];

// ===== EXTRA TEXTS (converted to cards) =====
const extraTexts: string[] = [
  "I love you more than yesterday, less than tomorrow.",
  "You're my favorite notification.",
  "Even when I'm grumpy, I still choose you.",
  "You make ordinary moments feel special.",
  "I'd choose you in every universe.",
  "You're the best part of my day.",
  "I love the way you love me.",
  "You make me want to be better.",
  "I'm so glad I get to do life with you.",
  "You're my person.",
  "I love your laugh more than any song.",
  "You make me feel safe.",
  "I'd still pick you, even knowing everything.",
  "You're the calm in my chaos.",
  "I love who I am when I'm with you.",
  "You're worth every hard day.",
  "I never knew I could love like this.",
  "You're my favorite hello and hardest goodbye.",
  "I love the little things about you.",
  "You make me believe in forever.",
  "I'm proud to be yours.",
  "You're my home.",
  "I love your weird. All of it.",
  "You're the first person I want to tell everything to.",
  "I choose you, {pet}. Every single day.",
  "You're my favorite adventure.",
  "I love how you make me feel seen.",
  "You're my happy place.",
  "I'd wait for you all over again.",
  "You're worth fighting for.",
  "I love your morning face.",
  "You make everything better.",
  "I'm grateful for you, {pet}.",
  "You're my best decision.",
  "I love how hard you love.",
  "You're the reason I smile at my phone.",
  "I'd follow you anywhere.",
  "You're my favorite kind of chaos.",
  "I love your heart so much.",
  "You make me want to try harder.",
  "I'm so lucky you're mine.",
  "You're my sunshine on cloudy days.",
  "I love the way you think.",
  "You're my forever crush.",
  "I'd choose this life with you again.",
  "You make my heart full.",
  "I love your determination.",
  "You're my favorite story.",
  "I'd still pick you, {pet}.",
  "You're worth every mile.",
  "I love your kindness.",
  "You're my favorite place to be.",
  "I'd do it all again for you.",
  "You make me feel whole.",
  "I love how we fit together.",
  "You're my biggest blessing.",
  "I'd still choose you, even on the hard days.",
  "You make everything worth it.",
  "I love your strength.",
  "You're my favorite part of every day.",
  "I'd wait forever if it meant having you.",
  "You make me feel alive.",
  "I love how you show up for me.",
  "You're my favorite view.",
  "I'd give you all my tomorrows.",
  "You make me feel understood.",
  "I love your patience with me.",
  "You're my favorite feeling.",
  "I'd choose you in every lifetime.",
  "You make my world brighter.",
  "I love how you challenge me.",
  "You're my favorite memory.",
  "I'd do anything to see you smile.",
  "You make me feel so loved.",
  "I love your persistence.",
  "You're my favorite dream.",
  "I'd cross oceans for you.",
  "You make everything magical.",
  "I love your courage.",
  "You're my favorite surprise.",
  "I'd wait through any storm for you.",
  "You make me believe in us.",
  "I love how you never give up.",
  "You're my favorite constant.",
  "I'd choose you over and over.",
  "You make me feel invincible.",
  "I love your gentleness.",
  "You're my favorite reason to wake up.",
  "I'd give up anything for you.",
  "You make me feel complete.",
  "I love how you hold me.",
  "You're my favorite truth.",
  "I'd fight for us every time.",
  "You make me feel like I matter.",
  "I love your resilience.",
  "You're my favorite promise.",
  "I'd wait a thousand lifetimes for you.",
  "You make me feel treasured.",
  "I love how you see me.",
  "You're my favorite forever.",
  "I'd choose you, always, {pet}.",
  "You make my heart skip every time.",
  "I love your soul.",
  "You're my favorite chapter.",
];

const extraTextCards: TextCard[] = extraTexts.map((text, i) => ({
  id: `extra-${String(i + 1).padStart(3, "0")}`,
  type: "text" as const,
  category: "sweet" as const,
  openWhen: "lonely",
  intensity: 1,
  rarity: "common" as const,
  emoji: "ðŸ’",
  tags: ["lonely"],
  text,
}));

// ===== CUSTOM CARDS FROM ADMIN =====
const CUSTOM_CARDS_KEY = "valentine-deck-custom-cards";

function getCustomCards(): Card[] {
  try {
    const stored = localStorage.getItem(CUSTOM_CARDS_KEY);
    return stored ? JSON.parse(stored) : [];
  } catch {
    return [];
  }
}

// ===== COMBINE ALL CARDS =====
const builtInCards: Card[] = [
  ...textCards,
  ...voucherCards,
  ...playlistCards,
  ...extraTextCards,
];

// allCards now includes custom cards from admin panel
export const allCards: Card[] = [...builtInCards, ...getCustomCards()];

// Function to get fresh cards list (includes any newly added custom cards)
export function getAllCards(): Card[] {
  return [...builtInCards, ...getCustomCards()];
}

// ===== HELPER FUNCTIONS =====
export function getCardById(id: string): Card | undefined {
  const allCardsNow = getAllCards();
  return allCardsNow.find((card) => card.id === id);
}

export function getAvailableCards(
  includeSecret: boolean = false,
  _mood?: string,
  openWhenMode?: string,
): Card[] {
  const allCardsNow = getAllCards();
  const redeemedVoucherIds = getRedeemedVoucherCardIds();
  
  let cards = allCardsNow.filter((card) => {
    // Filter out secret cards unless unlocked
    if (card.category === "secret" && !includeSecret) {
      return false;
    }
    // Filter out redeemed voucher cards (they reset monthly)
    if (card.type === "voucher" && redeemedVoucherIds.includes(card.id)) {
      return false;
    }
    return true;
  });

  // Filter by open when mode - include cards with matching tag OR matching category
  if (openWhenMode && openWhenMode !== "all") {
    const config = OPEN_WHEN_CATEGORIES[openWhenMode as OpenWhenKey];
    if (config) {
      const allowedCategories = config.categories as readonly string[];
      cards = cards.filter((card) => {
        const hasTag = card.tags?.includes(openWhenMode);
        const hasCategory = allowedCategories.includes(card.category);
        return hasTag || hasCategory;
      });
    } else {
      // Fallback: just filter by tag if no config found
      cards = cards.filter((card) => card.tags?.includes(openWhenMode));
    }
  }

  return cards;
}

// ===== EXPORTS FOR BACKWARDS COMPATIBILITY =====
export { textCards, voucherCards, playlistCards, extraTextCards };
export default allCards;
